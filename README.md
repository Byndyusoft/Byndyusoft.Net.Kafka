# Byndyusoft.Net.Kafka

Библиотека для работы с Kafka.

## Installing

```shell
dotnet add package Byndyusoft.Net.Kafka
```

## Configuration
```json
{
  "KafkaSettings" : {
    "Hosts": [
      "localhost:9092"
    ],
    "SecurityInformationEnabled" : false,
    "Prefix" : "example"
  },
  "KafkaSecurityInformationSettings" : {
    "Username" : "username",
    "Password" : "password",
    "SaslMechanism" : "ScramSha512",
    "SecurityProtocol" : "SaslPlaintext"
  }
}
```

## Usage

### Producer:
```c#
public class ExampleProducer : KafkaProducerBase<ExampleMessageDto>
    {
        public ExampleProducer(IProducerAccessor producers) : base(producers, "Title")
        {
        }

        public override string Topic  => "topic";
        
        public override string ClientName => "example_client";

        public override string KeyGenerator(ExampleMessageDto message)
        {
            return message.Guid.ToString();
        }
    }
```
**Note**: Title will be converted to snake case.

### Consumer:
```c#
public class ExampleConsumer : IKafkaConsumer
    {
        public ExampleConsumer(ExampleMessageHandler messageHandler)
        {
            MessageHandler = messageHandler;
        }   
        public string Topic => "topic";

        public string GroupName => "example_group";
        
        public IMessageHandler MessageHandler { get; }
    }
    
public sealed class ExampleMessageHandler : IMessageHandler<ExampleMessageDto>
{
    public async Task Handle(IMessageContext context, ExampleMessageDto message)
    {
        // Implementation
    }
}
```

### DI (Registration in Startup):
```c#
public void ConfigureServices(IServiceCollection services)
{
    ...
    services.AddKafkaBus(Configuration, name => name.Name!.Contains("Example.WebApplication"));
}
```
```c#
public void Configure(IApplicationBuilder app, IWebHostEnvironment webHostEnvironment, IHostApplicationLifetime lifetime)
{
    ...
    lifetime.RegisterKafkaBus(app);
}
```

## ClientId and GroupId
Now clientId and groupId generated by next templates:
```c#
public static string BuildProducerClientId(this IKafkaProducer producer, string prefix)
{
    return $"{prefix}.{producer.ClientName}.{producer.Topic.Replace(".", "_")}";
}

public static string BuildConsumerGroupId(this IKafkaConsumer consumer, string prefix)
{
    return $"{prefix}.{consumer.GroupName}.{consumer.Topic.Replace(".", "_")}";
}
```
[Issue](https://github.com/Byndyusoft/Byndyusoft.Net.Kafka/issues/4)